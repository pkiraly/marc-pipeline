# marc-pipeline
MARC pipeline for quality assessment preparation.

## prerequisites

* catmandu
* yaz-marcdump
*

## processing single files

1. `one-file-to-json.sh` - convert xml to json with Catmandu
1. `one-json-to-formatted.sh` - change the json format generated by Catmandu with the `formatCatmanduOutput.php` script 

## processing multiple files

1. `toXml.sh` - convert binary MARC files in `marc` directory to XML with `yaz-marcdump`, then split 
the files with `splitXml.php`. Each new file contains maximum 10.000 records.
1. `toJson.sh` - convert XML files in `splitted` directory with Catmandu. Moves converted files to `converted` and .json to `raw`
1. `jsonToFormatted.sh` - convert .json files in `json/raw` into a more convenient JSON format. Saves the new files into 
`json/formatted` directory, moves the source file into `json/processed`

## running the XML to JSON process with `cron` scheduler

Edit crontab with the 

```
crontab -e
```

command and add the following line:

```
*/1 * * * * cd /to/working/directory && php toJsonLauncher.php >> launch-report.log
```

This script runs the `one-file-to-json.sh` script on each files listed in the `to-json-setlist.txt` file.

## running the JSON formatting process with `cron` scheduler

Edit crontab with the 

```
crontab -e
```

command and add the following line:

```
*/1 * * * * cd /to/working/directory && php toFormattedLauncher.php >> launch-report.log
```

This script runs the `one-json-to-formatted.sh` script on each files listed in the `to-formatted-setlist.txt` file.
